name: Download Toolkit Remix Package

on:
  push:
    branches: [main]

jobs:
  rtx-remix-windows-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Download package
      run: |
        # Get current commit SHA (first 8 characters)
        SHORT_SHA="97eb63e0"
        
        echo "Current commit SHA: $SHORT_SHA"
        
        # Download with original filename preserved
        curl -L -O -J "https://d1oqksizpb0e3d.cloudfront.net/rtx_remix@latest"
        
        # Find the downloaded file
        DOWNLOADED_FILE=$(ls rtx_remix@*.zip 2>/dev/null | head -n 1)
        
        if [[ -f "$DOWNLOADED_FILE" ]]; then
          echo "Downloaded file: $DOWNLOADED_FILE"
          
          # Check if filename contains the commit SHA
          if [[ "$DOWNLOADED_FILE" == *"$SHORT_SHA"* ]]; then
            echo "✅ Filename contains commit SHA $SHORT_SHA - will upload"
            echo "SHOULD_UPLOAD=true" >> $GITHUB_ENV
            echo "FILENAME=$DOWNLOADED_FILE" >> $GITHUB_ENV
          else
            echo "❌ Filename does not contain commit SHA $SHORT_SHA - skipping upload"
            echo "SHOULD_UPLOAD=false" >> $GITHUB_ENV
          fi
        else
          echo "❌ No rtx_remix@*.zip file found"
          echo "SHOULD_UPLOAD=false" >> $GITHUB_ENV
        fi
    
    - name: Upload artifact
      if: env.SHOULD_UPLOAD == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: rtx-remix-package
        path: ${{ env.FILENAME }}